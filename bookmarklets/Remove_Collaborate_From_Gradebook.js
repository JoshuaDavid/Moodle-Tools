/* Allows you to remove a Collaborate session from the gradebook by right clicking it then
 * clicking "remove from gradebook". Useful because it's very easy to accidentally put them
 * into the gradebook.
 */

javascript:void (function() { var jq = document.createElement('script'); jq.src = window.location.protocol + '//code.jquery.com/jquery.min.js'; jq.onload = main; document.head.appendChild(jq); function main() { var $ = jQuery; if($ === undefined) { setTimeout(main, 100); return; } function matches(attr, regexp) { return (function(string) { return this[attr].match(regexp) }) } $('a') .filter(matches('title', /collaborate/gi)) .on('contextmenu', function(e) { var link = e.target; var id = e.target.href.match(/id=(\d+)/)[1]; var menu = $('<div/>').css({ "background": "white", "border": "1px solid black", "position": "absolute", "top": e.pageY + "px", "left": e.pageX + "px" }); var updateUrl = "/course/modedit.php?update=" + id; var removeFromGradebook = $('<div/>') .html("Remove from gradebook") .click(function() { menu.remove(); $.get(updateUrl, function(response) { var $form = $(response).find('form'); var action = '/course/modedit.php'; var data2 = $form.serialize(); var data1 = data2 + '&gradesession=1'; $.post(action, data1, function() { $.post(action, data2, function() { $(link).parentsUntil('tr').parent().remove(); }); }); }); }); menu.append(removeFromGradebook); $("body").append(menu); setTimeout(function() { menu.remove(); }, 5000); return false; }); } }());
